{% extends "_layout.html" %}
{% block content %}
<section class='lists-wrapper'></section>
<script>
  var lists = {
    1: {"pk": 1, "title": "Up Next", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    2: {"pk": 2, "title": "In Progress", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    3: {"pk": 3, "title": "On Hold", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    4: {"pk": 4, "title": "Testing", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    5: {"pk": 5, "title": "Done", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"}
  };
  var cards = {
    1: {"pk": 1, "title": "Card1", "contents": "Card1...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    2: {"pk": 2, "title": "Card2", "contents": "Card2...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    3: {"pk": 3, "title": "Card3", "contents": "Card3...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    4: {"pk": 4, "title": "Card4", "contents": "Card4...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    5: {"pk": 5, "title": "Card5", "contents": "Card5...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    6: {"pk": 6, "title": "Card6", "contents": "Card6...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    7: {"pk": 7, "title": "Card7", "contents": "Card7...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    8: {"pk": 8, "title": "Card8", "contents": "Card8...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    9: {"pk": 9, "title": "Card9", "contents": "Card9...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    10: {"pk": 10, "title": "Card10", "contents": "Card10...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    11: {"pk": 11, "title": "Card11", "contents": "Card11...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
    12: {"pk": 12, "title": "Card12", "contents": "Card12...", "created_at": "2000-01-01T00:00:00Z", "updated_at": "2000-01-01T12:00:00Z"},
  };
  var cards_in_list = {
    1: [1, 2, 3],
    2: [4, 5, 6],
    3: [7, 8, 9],
    4: [10, 11, 12],
    5: []
  }
  function printLists() {
    var dom = '';
    for (i in lists) {
      dom +=
        "<div class='float-left list-grid' id='list-" + i + "' data-list-id='" + i + "'>" +
        "<h4>" + lists[i].title + "</h4>" +
        "<div class='card-wrapper'></div>" +
        "<div class='add-card'>Add another card</div>" +
        "</div>";
    }
    $('.lists-wrapper').append(dom);
  }
  function printCards() {
    for (i in cards_in_list) {
      dom = '';
      for (j in cards_in_list[i]) {
        card_id = cards_in_list[i][j];
        dom +=
          "<div class='card-grid' id='card-" + card_id + "' data-card-id='" + card_id + "'>" +
          "<h5 class='card-title'>" + cards[card_id].title + "</h5>" +
          "</div>";
        var selector = "#list-" + i + ">.card-wrapper";
      }
      $(selector).append(dom);
    }
  }
  printLists();
  printCards();

  $( ".card-wrapper" ).sortable({
    connectWith: ".card-wrapper",
    handle: ".card-title",
    cancel: ".card-title-toggle",
    start: function (event, ui) {
      ui.item.addClass('tilt');
      var start_list_id = JSON.parse(JSON.stringify(ui.item.context.parentElement.parentElement.dataset)).listId;
      var card_id = parseInt(JSON.parse(JSON.stringify(ui.item.context.dataset)).cardId);
      var start_index = cards_in_list[start_list_id].indexOf(card_id);
      ui.item.data('start_list_id', start_list_id);
      ui.item.data('card_id', card_id);
      ui.item.data('start_index', start_index);
    },
    stop: function (event, ui) {
      ui.item.removeClass('tilt');
      var stop_list_id = JSON.parse(JSON.stringify(ui.item.context.parentElement.parentElement.dataset)).listId;
      if (ui.item.context.previousSibling === null) {
        var stop_index = 0;
      } else {
        var pre_card_id = parseInt(JSON.parse(JSON.stringify(ui.item.context.previousSibling.dataset)).cardId);
        var stop_index = cards_in_list[stop_list_id].indexOf(pre_card_id) + 1;
      }
      cards_in_list[ui.item.data('start_list_id')].splice(ui.item.data('start_index'), 1);
      cards_in_list[stop_list_id].splice(stop_index, 0, ui.item.data('card_id'));
      console.log(cards_in_list);
    }
  });
</script>
{% endblock %}
